{% extends "base.html" %}

{% block title %}Matem√°ticas Andinas - Inicio{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/game.css') }}">
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&display=swap" rel="stylesheet">

<style>
    /* =========================================
       üé® EST√âTICA ANDINA GLOBAL
       ========================================= */
    :root {
        --parchment-bg: #fdf5e6;
        --wood-dark: #3e2723;
        --wood-light: #8d6e63;
        --inca-gold: #FFD700;
        --terra-cotta: #d84315;
        --text-color: #3E2723;
    }

    body {
        font-family: 'Segoe UI', sans-serif;
    }

    /* Fondo Principal */
    .home-container {
        min-height: 100vh;
        display: flex; flex-direction: column; align-items: center; justify-content: center;
        position: relative;
        padding: 20px;
    }
    
    .home-background {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
        background-size: cover; background-position: center;
    }
    
    .home-overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
        background: radial-gradient(circle, rgba(62, 39, 35, 0.4) 0%, rgba(62, 39, 35, 0.8) 100%);
    }

    /* =========================================
       üìú EL PERGAMINO (CONTENEDOR)
       ========================================= */
    .pergamino-container {
        position: relative;
        width: 100%;
        max-width: 900px;
        background-color: var(--parchment-bg);
        border-top: 15px solid var(--wood-dark);
        border-bottom: 15px solid var(--wood-dark);
        border-radius: 5px;
        box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        padding: 40px;
        text-align: center;
    }

    /* T√çTULOS */
    .home-title {
        font-family: 'Cinzel', serif;
        font-weight: 900;
        font-size: 2.8em;
        color: var(--wood-dark);
        margin: 0;
        text-transform: uppercase;
        border-bottom: 2px solid var(--terra-cotta);
        display: inline-block;
        margin-bottom: 10px;
    }

    .home-subtitle {
        font-family: 'Cinzel', serif;
        font-size: 1.2em;
        color: var(--wood-light);
        margin-bottom: 30px;
    }

    /* =========================================
       üé® ICONOS ART√çSTICOS (CSS ART)
       ========================================= */
    
    /* --- ART: KHIPU --- */
    .art-khipu { width: 80px; height: 80px; position: relative; display: flex; justify-content: center; margin: 0 auto; }
    .k-rope { position: absolute; top: 10px; width: 100%; height: 6px; background: #5d4037; border-radius: 3px; }
    .k-str { width: 4px; height: 50px; background: #8d6e63; margin: 0 8px; position: relative; top: 14px; }
    .k-knot { width: 12px; height: 10px; background: #c62828; border-radius: 5px; position: absolute; left: -4px; box-shadow: 1px 1px 2px rgba(0,0,0,0.3); }

    /* --- ART: YUPANA --- */
    .art-yupana { 
        width: 70px; height: 70px; background: #8d6e63; border: 3px solid #3e2723; border-radius: 6px;
        display: grid; grid-template-columns: 1fr 1fr; gap: 4px; padding: 5px; margin: 0 auto;
        box-shadow: inset 2px 2px 5px rgba(0,0,0,0.3);
    }
    .y-hole { background: #d7ccc8; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: inset 1px 1px 3px rgba(0,0,0,0.2); }
    .y-dot { width: 14px; height: 14px; border-radius: 50%; border: 1px solid rgba(0,0,0,0.2); }
    .yd-r { background: #c62828; } 
    .yd-g { background: #2e7d32; } 
    .yd-y { background: #fbc02d; } 
    .yd-b { background: #1565c0; } 

    /* --- ART: CHACANA --- */
    .art-chacana { width: 70px; height: 70px; display: flex; align-items: center; justify-content: center; margin: 0 auto; }
    .ch-shape {
        width: 100%; height: 100%;
        clip-path: polygon(35% 0%, 65% 0%, 65% 35%, 100% 35%, 100% 65%, 65% 65%, 65% 100%, 35% 100%, 35% 65%, 0% 65%, 0% 35%, 35% 35%);
        background: radial-gradient(circle, #4fc3f7 40%, #0277bd 90%);
        box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    }
    .ch-center { width: 18px; height: 18px; background: #ff9800; border-radius: 50%; border: 2px solid white; box-shadow: 0 0 5px rgba(255, 152, 0, 0.8); }


    /* =========================================
       üéÆ INTERACTIVIDAD
       ========================================= */
    .games-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .game-option {
        background: white;
        border: 2px solid #e0e0e0;
        border-radius: 15px;
        padding: 20px;
        cursor: pointer;
        transition: all 0.3s;
    }

    .game-option:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(62, 39, 35, 0.2);
    }

    .game-option.selected {
        border: 3px solid var(--inca-gold);
        background: #fff8e1;
        transform: scale(1.05);
        box-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
    }

    .game-option h3 { margin: 10px 0 5px; color: var(--wood-dark); font-family: 'Cinzel', serif; }
    .game-option p { margin: 0; color: #666; font-size: 0.9em; }

    /* CONTROLES (Nivel y Grado) */
    .grade-selection {
        background: rgba(255,255,255,0.6);
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 25px;
        display: flex; justify-content: space-around; flex-wrap: wrap; gap: 20px;
    }

    .btn-level {
        padding: 8px 20px; border: 2px solid var(--wood-light);
        background: transparent; border-radius: 20px;
        font-weight: bold; color: var(--wood-dark); cursor: pointer;
    }
    .btn-level.active {
        background: var(--wood-dark); color: var(--inca-gold); border-color: var(--wood-dark);
    }

    .grade-dropdown {
        padding: 8px; border-radius: 5px; border: 2px solid var(--wood-dark);
        font-family: 'Cinzel', serif; font-weight: bold;
    }

    /* BOT√ìN JUGAR */
    .btn-play {
        background: linear-gradient(to bottom, #2e7d32, #1b5e20);
        color: white; border: none; padding: 15px 50px;
        border-radius: 50px; font-size: 1.2em; font-weight: bold;
        cursor: pointer; transition: 0.2s;
        box-shadow: 0 5px 0 #003300;
        width: 100%; max-width: 300px;
    }
    .btn-play:active { transform: translateY(4px); box-shadow: 0 1px 0 #003300; }
    
    .btn-play.disabled {
        background: #bdbdbd; box-shadow: none; cursor: not-allowed;
    }

    /* FOOTER */
    .additional-options { margin-top: 30px; display: flex; justify-content: center; gap: 15px; }
    .option-link {
        text-decoration: none; color: var(--wood-dark); font-weight: bold;
        padding: 8px 15px; background: rgba(255,255,255,0.5); border-radius: 15px;
        transition: 0.2s;
    }
    .option-link:hover { background: var(--wood-dark); color: var(--inca-gold); }

</style>
{% endblock %}

{% block content %}
<div class="home-container">
    <div class="home-background" style="background-image: url('{{ url_for('static', filename='images/backgrounds/inicio.png') }}');">
        <div class="home-overlay"></div>
    </div>

    <div class="pergamino-container">
        <header>
            <h1 class="home-title">Inkaq Yachaywan Pukllasun</h1>
            <p class="home-subtitle">"Aprende jugando con la sabidur√≠a ancestral"</p>
        </header>

        <div class="games-grid">
            
            <div class="game-option" data-game="khipu" role="button" tabindex="0">
                <div class="art-khipu">
                    <div class="k-rope"></div>
                    <div class="k-str"><div class="k-knot" style="top:10px"></div><div class="k-knot" style="top:30px"></div></div>
                    <div class="k-str" style="height:60px"><div class="k-knot" style="top:20px"></div></div>
                    <div class="k-str"><div class="k-knot" style="top:40px"></div></div>
                </div>
                <h3>Khipu</h3>
                <p>El poder de los nudos</p>
            </div>
            
            <div class="game-option" data-game="yupana" role="button" tabindex="0">
                <div class="art-yupana">
                    <div class="y-hole"><div class="y-dot yd-r"></div></div>
                    <div class="y-hole"><div class="y-dot yd-g"></div></div>
                    <div class="y-hole"><div class="y-dot yd-y"></div></div>
                    <div class="y-hole"><div class="y-dot yd-b"></div></div>
                </div>
                <h3>Yupana</h3>
                <p>Calculador de piedra</p>
            </div>
            
            <div class="game-option" data-game="chacana" role="button" tabindex="0">
                <div class="art-chacana">
                    <div class="ch-shape">
                        <div class="ch-center"></div>
                    </div>
                </div>
                <h3>Chacana</h3>
                <p>Geometr√≠a sagrada</p>
            </div>

        </div>

        <div class="grade-selection">
            <div class="selector-group">
                <h4 style="margin:0 0 10px 0; color:var(--wood-dark)">Nivel</h4>
                <div class="level-buttons">
                    <button class="btn-level active" data-level="primaria">Primaria</button>
                    <button class="btn-level" data-level="secundaria">Secundaria</button>
                </div>
            </div>
            
            <div class="selector-group">
                <h4 style="margin:0 0 10px 0; color:var(--wood-dark)">Grado</h4>
                <select id="gradeSelect" class="grade-dropdown">
                    <option value="1">1¬∞ Grado</option>
                    <option value="2">2¬∞ Grado</option>
                    <option value="3">3¬∞ Grado</option>
                    <option value="4">4¬∞ Grado</option>
                    <option value="5">5¬∞ Grado</option>
                    <option value="6">6¬∞ Grado</option>
                </select>
            </div>
        </div>

        <button class="btn-play disabled" id="playButton" disabled>
            <span id="playText">Selecciona una Aventura</span>
        </button>

        <div class="additional-options">
            <a href="/perfil" class="option-link">üë§ Mi Perfil</a>
            <a href="/admin/levels" class="option-link">‚öôÔ∏è Editor</a>
            <a href="/instrucciones" class="option-link">üìú Leyendas</a>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        
        // --- Variables ---
        let selectedGame = null;
        let selectedLevel = 'primaria';
        
        // --- Elementos ---
        const gameOptions = document.querySelectorAll('.game-option');
        const levelButtons = document.querySelectorAll('.btn-level');
        const gradeSelect = document.getElementById('gradeSelect');
        const playButton = document.getElementById('playButton');
        const playText = document.getElementById('playText');

        // 1. Selecci√≥n de JUEGO
        gameOptions.forEach(option => {
            option.addEventListener('click', () => {
                gameOptions.forEach(opt => opt.classList.remove('selected'));
                option.classList.add('selected');
                selectedGame = option.getAttribute('data-game');
                updatePlayButton();
            });
        });

        // 2. Selecci√≥n de NIVEL
        levelButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                levelButtons.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                selectedLevel = btn.getAttribute('data-level');
                updateGrades(selectedLevel);
            });
        });

        // 3. Actualizar lista de Grados
        function updateGrades(level) {
            gradeSelect.innerHTML = '';
            const maxGrade = (level === 'primaria') ? 6 : 5;
            const suffix = (level === 'primaria') ? '¬∞ Grado' : '¬∞ A√±o Sec.';
            
            for(let i=1; i<=maxGrade; i++) {
                let option = document.createElement('option');
                option.value = i;
                option.text = i + suffix;
                gradeSelect.appendChild(option);
            }
        }

        // 4. Actualizar Bot√≥n Jugar
        function updatePlayButton() {
            if (selectedGame) {
                playButton.disabled = false;
                playButton.classList.remove('disabled');
                const gameName = selectedGame.charAt(0).toUpperCase() + selectedGame.slice(1);
                playText.textContent = "¬°Jugar a " + gameName + "! ‚ñ∂";
            } else {
                playButton.disabled = true;
                playButton.classList.add('disabled');
                playText.textContent = "Selecciona una Aventura";
            }
        }

        // 5. CLICK EN JUGAR (Redirecci√≥n)
        playButton.addEventListener('click', () => {
            if (!selectedGame) return;
            const grade = gradeSelect.value;
            // Construye la URL: /yupana?level=primaria&grade=1
            window.location.href = `/${selectedGame}?level=${selectedLevel}&grade=${grade}`;
        });
    });
</script>
{% endblock %}