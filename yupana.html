<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yupana - Matem√°ticas Andinas</title>
    
    <!-- CHANGE HERE: Rutas de CSS y metadatos -->
    <meta name="description" content="Juego educativo de matem√°ticas con elementos de la cultura andina">
    <meta name="keywords" content="matem√°ticas, educaci√≥n, cultura andina, khipu, yupana, chacana">
    <meta name="author" content="Matem√°ticas Andinas">
    
    <link rel="stylesheet" href="static/css/base.css">


    <!-- Favicon -->
    <link rel="icon" type="image/png" href="static/images/logos/logouno.png">
</head>
<body>
    <!-- Header Navigation -->
    <header class="game-header" id="gameHeader" style="display: none;">
        <div class="header-content">
            <div class="header-left">
                <button class="btn-home" onclick="goHome()" aria-label="Volver al inicio">
                    <span class="icon-home">üè†</span>
                </button>
                <div class="level-info">
                    <span id="currentLevel">Nivel 1</span>
                    <span id="currentGrade">Grado 1</span>
                </div>
            </div>

            <div class="header-center">
                <h1 id="gameTitle">Yupana - El √Åbaco Inca</h1>
            </div>

            <div class="header-right">
                <button class="btn-pause" onclick="togglePause()" aria-label="Pausar juego">
                    <span class="icon-pause">‚è∏Ô∏è</span>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="game-container">
    <div class="game-background" style="position: absolute; top:0; left:0; width:100%; height:100%; z-index:-1;"></div>

    <div class="sidebar-panel">
        <a href="index.html" class="btn-home">
            üè† Volver al Inicio
        </a>

        <h2 class="question-title">La Yupana</h2>
        
        <p style="color: #5d4037; margin-top: 15px;">
            El √°baco de piedra sagrado.
            <br><br>
            <strong>Misi√≥n:</strong> Llena los huecos con ma√≠z para sumar.
        </p>

        <div style="background: rgba(0,0,0,0.05); padding: 15px; border-radius: 8px; font-size: 0.9em;">
            <strong>Reglas Ancestrales:</strong>
            <ul style="padding-left: 20px; margin-top: 5px;">
                <li><strong>Abajo:</strong> 5 huecos (Base)</li>
                <li><strong>Medio:</strong> 3 huecos (Cuerpo)</li>
                <li><strong>Arriba:</strong> 2 huecos (Cabeza)</li>
                <li style="color:#c0392b; font-weight:bold; margin-top:5px;">¬°10 ma√≠ces = CANJE!</li>
            </ul>
        </div>
        
        <button class="btn" onclick="showHelp()" style="width:100%; background:#8B4513; margin-top:auto;">
            ‚ùì Ayuda
        </button>
    </div>

    <div class="main-game-stage">
        
        <div class="info-panel">
            <div>OBJETIVO: <span id="targetDisplay" style="color: #FFD700;">--</span></div>
            <div>VALOR: <span id="currentDisplay" style="color: #2ecc71;">0</span></div>
        </div>

        <div class="yupana-board">
            
            <div class="yupana-column" id="col-2" onclick="addToken(2)">
                <div class="col-header">Centena (100)</div>
                
                <div class="section-block section-top">
                    <div class="socket" id="c2-s9"></div>
                    <div class="socket" id="c2-s10"></div>
                </div>
                
                <div class="section-block section-mid">
                    <div class="socket" id="c2-s6"></div>
                    <div class="socket" id="c2-s7"></div>
                    <div class="socket" id="c2-s8"></div>
                </div>
                
                <div class="section-block section-bot">
                    <div class="socket" id="c2-s1"></div>
                    <div class="socket" id="c2-s2"></div>
                    <div class="socket" id="c2-s3"></div>
                    <div class="socket" id="c2-s4"></div>
                    <div class="socket" id="c2-s5"></div>
                </div>

                <button class="btn-canje hidden" id="canje-2" onclick="doCanje(event, 2)">üîÑ<br>CANJE</button>
            </div>

            <div class="yupana-column" id="col-1" onclick="addToken(1)">
                <div class="col-header">Decena (10)</div>
                
                <div class="section-block section-top">
                    <div class="socket" id="c1-s9"></div>
                    <div class="socket" id="c1-s10"></div>
                </div>
                
                <div class="section-block section-mid">
                    <div class="socket" id="c1-s6"></div>
                    <div class="socket" id="c1-s7"></div>
                    <div class="socket" id="c1-s8"></div>
                </div>
                
                <div class="section-block section-bot">
                    <div class="socket" id="c1-s1"></div>
                    <div class="socket" id="c1-s2"></div>
                    <div class="socket" id="c1-s3"></div>
                    <div class="socket" id="c1-s4"></div>
                    <div class="socket" id="c1-s5"></div>
                </div>

                <button class="btn-canje hidden" id="canje-1" onclick="doCanje(event, 1)">üîÑ<br>CANJE</button>
            </div>

            <div class="yupana-column" id="col-0" onclick="addToken(0)">
                <div class="col-header">Unidad (1)</div>
                
                <div class="section-block section-top">
                    <div class="socket" id="c0-s9"></div>
                    <div class="socket" id="c0-s10"></div>
                </div>
                
                <div class="section-block section-mid">
                    <div class="socket" id="c0-s6"></div>
                    <div class="socket" id="c0-s7"></div>
                    <div class="socket" id="c0-s8"></div>
                </div>
                
                <div class="section-block section-bot">
                    <div class="socket" id="c0-s1"></div>
                    <div class="socket" id="c0-s2"></div>
                    <div class="socket" id="c0-s3"></div>
                    <div class="socket" id="c0-s4"></div>
                    <div class="socket" id="c0-s5"></div>
                </div>

                <button class="btn-canje hidden" id="canje-0" onclick="doCanje(event, 0)">üîÑ<br>CANJE</button>
            </div>

        </div>

        <div class="controls">
            <button class="btn btn-new" onclick="newProblem()">üéØ Nueva Suma</button>
            <button class="btn btn-reset" onclick="resetYupana()">üóëÔ∏è Borrar Todo</button>
            <button class="btn btn-check" onclick="checkResult()">‚úÖ Verificar</button>
        </div>
        
        <div id="feedback" style="height: 30px; font-weight: bold; font-size: 1.2em; text-align: center;"></div>
    </div>
</div>

<div class="modal" id="helpModal" style="display: none;">
    <div class="modal-content" style="border: 4px solid #8B4513; background:#fdf5e6;">
        <div class="modal-header" style="background:#8B4513; color:white;">
            <h3>Secreto de la Yupana</h3>
            <button class="modal-close" onclick="closeHelp()">&times;</button>
        </div>
        <div class="modal-body" style="color:#3e2723;">
            <p>Este tablero imita la antigua Yupana de madera.</p>
            <p>1. Llena los huecos de abajo hacia arriba.</p>
            <p>2. Cada columna tiene capacidad para <strong>10 ma√≠ces</strong>.</p>
            <p>3. Cuando llenas todos los huecos, ¬°haz el canje!</p>
        </div>
    </div>
</div>

<script>
window.GAME_DATA = {
    game: 'yupana',
    grade: '1',
    level: '1'
};
</script>
    </main>

    <!-- Pause Overlay -->
    <div class="pause-overlay" id="pauseOverlay" style="display: none;">
        <div class="pause-menu">
            <h2>Juego Pausado</h2>
            <div class="pause-buttons">
                <button class="btn btn-primary" onclick="resumeGame()" aria-label="Reanudar juego">
                    Reanudar
                </button>
                <button class="btn btn-secondary" onclick="restartLevel()" aria-label="Reiniciar nivel">
                    Reiniciar Nivel
                </button>
                <button class="btn btn-tertiary" onclick="goHome()" aria-label="Volver al inicio">
                    Volver al Inicio
                </button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay" style="display: none;">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <p>Cargando...</p>
        </div>
    </div>

    <!-- Scripts -->
    <script src="static/js/main.js"></script>
    <script src="static/js/game-common.js"></script>
    <script>
    // Variables Globales
    let colValues = [0, 0, 0]; // [Unidades, Decenas, Centenas]
    let targetProblem = { num1: 0, num2: 0, total: 0 };

    document.addEventListener('DOMContentLoaded', () => {
        console.log("üåΩ Yupana 5-3-2 Iniciada");
        newProblem();
    });

    // 1. GENERAR PROBLEMA
    function newProblem() {
        let n1 = Math.floor(Math.random() * 40) + 1;
        let n2 = Math.floor(Math.random() * 40) + 1;
        targetProblem = { num1: n1, num2: n2, total: n1 + n2 };

        document.getElementById('targetDisplay').innerText = `${n1} + ${n2} = ?`;
        document.getElementById('feedback').innerText = "";
        resetYupana();
    }

    // 2. AGREGAR MA√çZ
    function addToken(colIndex) {
        if (colValues[colIndex] < 10) {
            colValues[colIndex]++;
            updateVisuals(colIndex);
        } else {
            const btn = document.getElementById(`canje-${colIndex}`);
            btn.classList.add('visible');
        }
    }

    // 3. CANJE
    function doCanje(event, colIndex) {
        event.stopPropagation();
        
        if (colValues[colIndex] >= 10) {
            colValues[colIndex] -= 10;
            updateVisuals(colIndex);
            
            // Pasar 1 a la siguiente columna
            if (colIndex + 1 < colValues.length) {
                setTimeout(() => {
                    addToken(colIndex + 1);
                }, 300);
            }
        }
    }

    // 4. ACTUALIZAR VISUALES
    function updateVisuals(colIndex) {
        const currentVal = colValues[colIndex];
        const colDiv = document.getElementById(`col-${colIndex}`);
        const btnCanje = document.getElementById(`canje-${colIndex}`);

        for (let i = 1; i <= 10; i++) {
            const socket = document.getElementById(`c${colIndex}-s${i}`);
            if (i <= currentVal) {
                socket.classList.add('filled');
            } else {
                socket.classList.remove('filled');
            }
        }

        if (currentVal >= 10) {
            colDiv.classList.add('column-overflow');
            btnCanje.classList.remove('hidden');
            btnCanje.classList.add('visible');
        } else {
            colDiv.classList.remove('column-overflow');
            btnCanje.classList.remove('visible');
            btnCanje.classList.add('hidden');
        }

        let total = (colValues[2] * 100) + (colValues[1] * 10) + colValues[0];
        document.getElementById('currentDisplay').innerText = total;
    }

    // 5. VERIFICAR
    function checkResult() {
        let total = (colValues[2] * 100) + (colValues[1] * 10) + colValues[0];
        const feedback = document.getElementById('feedback');

        if (colValues[0] >= 10 || colValues[1] >= 10) {
            feedback.innerHTML = "<span style='color:#c0392b'>‚ö†Ô∏è ¬°Completa los canjes primero!</span>";
            return;
        }

        if (total === targetProblem.total) {
            feedback.innerHTML = "<span style='color:#27ae60'>üéâ ¬°Correcto! Sabidur√≠a Inca.</span>";
            setTimeout(newProblem, 2000);
        } else {
            feedback.innerHTML = "<span style='color:#c0392b'>‚ùå Incorrecto. Revisa la suma.</span>";
        }
    }

    function resetYupana() {
        colValues = [0, 0, 0];
        updateVisuals(0);
        updateVisuals(1);
        updateVisuals(2);
    }

    function showHelp() { document.getElementById('helpModal').style.display = 'flex'; }
    function closeHelp() { document.getElementById('helpModal').style.display = 'none'; }
</script>

    <!-- CHANGE HERE: Configuraci√≥n de desarrollo -->
    <script>
        // Configuraci√≥n global de la aplicaci√≥n
        window.MATEMATICAS_ANDINAS = {
            version: '1.0.0',
            debug: true, // CHANGE HERE: false para producci√≥n
            apiUrl: '/api'
        };

        // SUGGEST: make a git commit and tag as v1.0.0
        // Ejemplo: git commit -m "feat: initial complete implementation of Matematicas Andinas educational game"
        console.log('üèîÔ∏è Matem√°ticas Andinas v' + window.MATEMATICAS_ANDINAS.version + ' cargado correctamente');
    </script>
        <script>
            // Shim global ligero para compatibilidad entre scripts.
            // Evita errores cuando algunos scripts esperan window.MathAndinas
            if (!window.MathAndinas) {
                window.MathAndinas = {
                    showPause: showPause || function() { const o = document.getElementById('pauseOverlay'); if (o) o.style.display='flex'; },
                    resumeGame: resumeGame || function() { const o = document.getElementById('pauseOverlay'); if (o) o.style.display='none'; },
                    goHome: goHome || function() { window.location.href = '/'; },
                    showNotification: function(message, type) {
                        // Simple fallback visual
                        const n = document.createElement('div');
                        n.className = 'toast-notification ' + (type || 'info');
                        n.textContent = message;
                        Object.assign(n.style, { position: 'fixed', right: '20px', bottom: '20px', background: '#333', color: '#fff', padding: '10px 14px', borderRadius: '8px', zIndex: 10000 });
                        document.body.appendChild(n);
                        setTimeout(() => n.remove(), 3500);
                    }
                };
            }
        </script>
</body>
</html>