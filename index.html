<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Matem√°ticas Andinas - Inicio</title>

    <!-- CHANGE HERE: Rutas de CSS y metadatos -->
    <meta name="description" content="Juego educativo de matem√°ticas con elementos de la cultura andina">
    <meta name="keywords" content="matem√°ticas, educaci√≥n, cultura andina, khipu, yupana, chacana">
    <meta name="author" content="Matem√°ticas Andinas">

    <link rel="stylesheet" href="static/css/base.css">


    <!-- Favicon -->
    <link rel="icon" type="image/png" href="static/images/logos/logouno.png">
</head>
<body>
    <!-- Header Navigation -->
    <header class="game-header" id="gameHeader" style="display: none;">
        <div class="header-content">
            <div class="header-left">
                <button class="btn-home" onclick="goHome()" aria-label="Volver al inicio">
                    <span class="icon-home">üè†</span>
                </button>
                <div class="level-info">
                    <span id="currentLevel">Nivel 1</span>
                    <span id="currentGrade">Grado 1</span>
                </div>
            </div>

            <div class="header-center">
                <h1 id="gameTitle">{% block game_title %}Matem√°ticas Andinas{% endblock %}</h1>
            </div>

            <div class="header-right">
                <button class="btn-pause" onclick="togglePause()" aria-label="Pausar juego">
                    <span class="icon-pause">‚è∏Ô∏è</span>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="home-container">
    <div class="home-background" style="background-image: url('static/images/backgrounds/inicio.png');">
        <div class="home-overlay"></div>
    </div>

    <div class="pergamino-container">
        <header>
            <h1 class="home-title">Inkaq Yachaywan Pukllasun</h1>
            <p class="home-subtitle">"Aprende jugando con la sabidur√≠a ancestral"</p>
        </header>

        <div class="games-grid">

            <div class="game-option" data-game="khipu" role="button" tabindex="0">
                <div class="art-khipu">
                    <div class="k-rope"></div>
                    <div class="k-str"><div class="k-knot" style="top:10px"></div><div class="k-knot" style="top:30px"></div></div>
                    <div class="k-str" style="height:60px"><div class="k-knot" style="top:20px"></div></div>
                    <div class="k-str"><div class="k-knot" style="top:40px"></div></div>
                </div>
                <h3>Khipu</h3>
                <p>El poder de los nudos</p>
            </div>

            <div class="game-option" data-game="yupana" role="button" tabindex="0">
                <div class="art-yupana">
                    <div class="y-hole"><div class="y-dot yd-r"></div></div>
                    <div class="y-hole"><div class="y-dot yd-g"></div></div>
                    <div class="y-hole"><div class="y-dot yd-y"></div></div>
                    <div class="y-hole"><div class="y-dot yd-b"></div></div>
                </div>
                <h3>Yupana</h3>
                <p>Calculador de piedra</p>
            </div>

            <div class="game-option" data-game="chacana" role="button" tabindex="0">
                <div class="art-chacana">
                    <div class="ch-shape">
                        <div class="ch-center"></div>
                    </div>
                </div>
                <h3>Chacana</h3>
                <p>Geometr√≠a sagrada</p>
            </div>

        </div>

        <div class="grade-selection">
            <div class="selector-group">
                <h4 style="margin:0 0 10px 0; color:var(--wood-dark)">Nivel</h4>
                <div class="level-buttons">
                    <button class="btn-level active" data-level="primaria">Primaria</button>
                    <button class="btn-level" data-level="secundaria">Secundaria</button>
                </div>
            </div>

            <div class="selector-group">
                <h4 style="margin:0 0 10px 0; color:var(--wood-dark)">Grado</h4>
                <select id="gradeSelect" class="grade-dropdown">
                    <option value="1">1¬∞ Grado</option>
                    <option value="2">2¬∞ Grado</option>
                    <option value="3">3¬∞ Grado</option>
                    <option value="4">4¬∞ Grado</option>
                    <option value="5">5¬∞ Grado</option>
                    <option value="6">6¬∞ Grado</option>
                </select>
            </div>
        </div>

        <button class="btn-play disabled" id="playButton" disabled>
            <span id="playText">Selecciona una Aventura</span>
        </button>

        <div class="additional-options">
            <a href="/perfil" class="option-link">üë§ Mi Perfil</a>
            <a href="/admin/levels" class="option-link">‚öôÔ∏è Editor</a>
            <a href="/instrucciones" class="option-link">üìú Leyendas</a>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {

        // --- Variables ---
        let selectedGame = null;
        let selectedLevel = 'primaria';

        // --- Elementos ---
        const gameOptions = document.querySelectorAll('.game-option');
        const levelButtons = document.querySelectorAll('.btn-level');
        const gradeSelect = document.getElementById('gradeSelect');
        const playButton = document.getElementById('playButton');
        const playText = document.getElementById('playText');

        // 1. Selecci√≥n de JUEGO
        gameOptions.forEach(option => {
            option.addEventListener('click', () => {
                gameOptions.forEach(opt => opt.classList.remove('selected'));
                option.classList.add('selected');
                selectedGame = option.getAttribute('data-game');
                updatePlayButton();
            });
        });

        // 2. Selecci√≥n de NIVEL
        levelButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                levelButtons.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                selectedLevel = btn.getAttribute('data-level');
                updateGrades(selectedLevel);
            });
        });

        // 3. Actualizar lista de Grados
        function updateGrades(level) {
            gradeSelect.innerHTML = '';
            const maxGrade = (level === 'primaria') ? 6 : 5;
            const suffix = (level === 'primaria') ? '¬∞ Grado' : '¬∞ A√±o Sec.';

            for(let i=1; i<=maxGrade; i++) {
                let option = document.createElement('option');
                option.value = i;
                option.text = i + suffix;
                gradeSelect.appendChild(option);
            }
        }

        // 4. Actualizar Bot√≥n Jugar
        function updatePlayButton() {
            if (selectedGame) {
                playButton.disabled = false;
                playButton.classList.remove('disabled');
                const gameName = selectedGame.charAt(0).toUpperCase() + selectedGame.slice(1);
                playText.textContent = "¬°Jugar a " + gameName + "! ‚ñ∂";
            } else {
                playButton.disabled = true;
                playButton.classList.add('disabled');
                playText.textContent = "Selecciona una Aventura";
            }
        }

        // 5. CLICK EN JUGAR (Redirecci√≥n)
        playButton.addEventListener('click', () => {
            if (!selectedGame) return;
            const grade = gradeSelect.value;
            // Construye la URL: /yupana?level=primaria&grade=1
            window.location.href = `/${selectedGame}?level=${selectedLevel}&grade=${grade}`;
        });
    });
</script>
    </main>

    <!-- Pause Overlay -->
    <div class="pause-overlay" id="pauseOverlay" style="display: none;">
        <div class="pause-menu">
            <h2>Juego Pausado</h2>
            <div class="pause-buttons">
                <button class="btn btn-primary" onclick="resumeGame()" aria-label="Reanudar juego">
                    Reanudar
                </button>
                <button class="btn btn-secondary" onclick="restartLevel()" aria-label="Reiniciar nivel">
                    Reiniciar Nivel
                </button>
                <button class="btn btn-tertiary" onclick="goHome()" aria-label="Volver al inicio">
                    Volver al Inicio
                </button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay" style="display: none;">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <p>Cargando...</p>
        </div>
    </div>

    <!-- Scripts -->
    <script src="static/js/main.js"></script>
    <script src="static/js/game-common.js"></script>
    {% block extra_js %}{% endblock %}

    <!-- CHANGE HERE: Configuraci√≥n de desarrollo -->
    <script>
        // Configuraci√≥n global de la aplicaci√≥n
        window.MATEMATICAS_ANDINAS = {
            version: '1.0.0',
            debug: true, // CHANGE HERE: false para producci√≥n
            apiUrl: '/api'
        };

        // SUGGEST: make a git commit and tag as v1.0.0
        // Ejemplo: git commit -m "feat: initial complete implementation of Matematicas Andinas educational game"
        console.log('üèîÔ∏è Matem√°ticas Andinas v' + window.MATEMATICAS_ANDINAS.version + ' cargado correctamente');
    </script>
        <script>
            // Shim global ligero para compatibilidad entre scripts.
            // Evita errores cuando algunos scripts esperan window.MathAndinas
            if (!window.MathAndinas) {
                window.MathAndinas = {
                    showPause: showPause || function() { const o = document.getElementById('pauseOverlay'); if (o) o.style.display='flex'; },
                    resumeGame: resumeGame || function() { const o = document.getElementById('pauseOverlay'); if (o) o.style.display='none'; },
                    goHome: goHome || function() { window.location.href = '/'; },
                    showNotification: function(message, type) {
                        // Simple fallback visual
                        const n = document.createElement('div');
                        n.className = 'toast-notification ' + (type || 'info');
                        n.textContent = message;
                        Object.assign(n.style, { position: 'fixed', right: '20px', bottom: '20px', background: '#333', color: '#fff', padding: '10px 14px', borderRadius: '8px', zIndex: 10000 });
                        document.body.appendChild(n);
                        setTimeout(() => n.remove(), 3500);
                    }
                };
            }
        </script>
</body>
</html>